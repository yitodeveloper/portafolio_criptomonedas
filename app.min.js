var subscribe=Cookies.getJSON("subscribeCrypto"),info={},tokenSelected="",tokenMap=[],start=0;function addCrypto(){var t=$("#crypto").val();t=t.toUpperCase(),void 0!==subscribe&&null!==subscribe||(subscribe=[]);var e=!1;if($.each(info,function(a,o){o.symbol==t&&(e=!0)}),!e){var a=searchToken(t);if(!1===a)return void $(".statusText").html("<span class='text-danger'>¡Moneda "+t+" no encontrada!</span>").fadeIn();t=a}-1===$.inArray(t,subscribe)&&(subscribe.push(t),Cookies.set("subscribeCrypto",subscribe),drawCards(),$("#crypto").val("").focus())}function searchToken(t){return t=t.toLowerCase(),symbol=!1,$.each(tokenMap,function(e,a){a.name.toLowerCase()===t&&(symbol=a.symbol)}),symbol}function deleteCard(t){$(".statusText").html("Eliminando "+t+" de la lista"),subscribe.splice($.inArray(t,subscribe),1),Cookies.set("subscribeCrypto",subscribe),$(".cardcrypto-"+t).remove(),drawCards()}function setTokenMap(){start=1,$.each(info,function(t,e){var a={};a.id=e.id,a.name=e.name,a.symbol=e.symbol,tokenMap.push(a)});var t={data:tokenMap,getValue:"name",list:{match:{enabled:!0},sort:{enabled:!0}},template:{type:"custom",method:function(t,e){return e.name+" ("+e.symbol+")"}}};$("#crypto").easyAutocomplete(t).focus()}function getData(){$(".statusText").html("Actualizando ...").fadeIn(),$.ajax({url:"https://api.coinmarketcap.com/v1/ticker/?convert=CLP&limit=0",type:"GET",dataType:"json",data:{},success:function(t){info=t,$(".statusText").fadeOut("slow"),drawCards(),0===start&&setTokenMap()},error:{}})}function drawCards(){$(".resumen").html("");var t=0;$.each(info,function(e,a){if(-1!==$.inArray(a.symbol,subscribe)){var o=selfAmount(a.price_clp,a.symbol);t+=o;var n=$("<div>");n.addClass("cardcrypto-"+a.symbol),n.addClass("card col-12 col-sm-5 offset-sm-1 col-lg-3 mb-4");var s=$("<div>");s.addClass("card-body");var r=$("<div class='row'></div>");r.append('<div class="col-4"><h5 class="card-title">'+a.symbol+' to CLP</h5><p class="card-subtitle">Mi '+a.name+" en Peso Chileno</p></div>"),r.append('<div class="col-8"><h2>$'+o.toLocaleString()+'</h2><p title="Equivalente a un Ethereum">Valor CLP: $'+Math.round(a.price_clp).toLocaleString()+" <br> Cambio 24h: "+writeChange24(a.percent_change_24h)+'</p><div class="row"><div class="col-6"><button class="btn btn-danger btn-sm" onclick="deleteCard(\''+a.symbol+'\')">Eliminar</button></div><div class="col-6"><button class="btn btn-primary btn-sm" onclick="editAmount(\''+a.symbol+"')\" >Configurar</button></div></div></div>"),s.append(r),n.append(s),$(".resumen").append(n)}}),$("#total").html("$"+t.toLocaleString())}function editAmount(t){tokenSelected=t;var e=Cookies.get("amount-"+t);$("#inputAmount").val(e),$(".modal-title").html("¿Cuantos "+t+" tengo?"),$(".modal").modal("show")}function updateAmount(){var t=$("#inputAmount").val();Cookies.set("amount-"+tokenSelected,t),$(".modal").modal("hide"),drawCards()}function writeChange24(t){return t>=0?"<span class='text-success'>"+t+"%</span>":"<span class='text-danger'>"+t+"%</span>"}function selfAmount(t,e){var a=Cookies.get("amount-"+e);return void 0===a&&(a=0,Cookies.set("amount-"+e,0)),0!==a?Math.round(a*t):0}$(document).ready(function(){$(".formAdd").submit(function(t){t.preventDefault(),addCrypto()}),$("#updateAmount").click(function(){updateAmount()}),getData(),setInterval(function(){getData()},6e4)});